!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GlslCanvas=e()}(this,function(){"use strict";function t(t,e,i){for(var r=0,n=t.length;r<n;r++)L.call(t,r)&&e.call(i,t[r],r,t)}function e(t,e,i){for(var r=0,n=t.length;r<n;r++)e.call(i,t.charAt(r),r,t)}function i(t,e,i){for(var r in t)L.call(t,r)&&e.call(i,t[r],r,t)}function r(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function n(t,e,i){var r=t;return _(e)?(i=e,"string"==typeof t&&(r={uri:t})):r=X(e,{uri:t}),r.callback=i,r}function o(t,e,i){return e=n(t,e,i),a(e)}function a(t){function e(){var t=void 0;if(t=u.response?u.response:u.responseText||s(u),y)try{t=JSON.parse(t)}catch(t){}return t}function i(t){return clearTimeout(c),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,l(t,E)}function n(){if(!f){var i;clearTimeout(c),i=t.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var r=E,n=null;return 0!==i?(r={body:e(),statusCode:i,method:g,headers:{},url:d,rawRequest:u},u.getAllResponseHeaders&&(r.headers=U(u.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),l(n,r,r.body)}}if(void 0===t.callback)throw new Error("callback argument missing");var a=!1,l=function(e,i,r){a||(a=!0,t.callback(e,i,r))},u=t.xhr||null;u||(u=t.cors||t.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var h,f,c,d=u.url=t.uri||t.url,g=u.method=t.method||"GET",v=t.body||t.data,m=u.headers=t.headers||{},p=!!t.sync,y=!1,E={body:void 0,headers:{},statusCode:0,method:g,url:d,rawRequest:u};if("json"in t&&!1!==t.json&&(y=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==g&&"HEAD"!==g&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),v=JSON.stringify(!0===t.json?v:t.json))),u.onreadystatechange=function(){4===u.readyState&&setTimeout(n,0)},u.onload=n,u.onerror=i,u.onprogress=function(){},u.onabort=function(){f=!0},u.ontimeout=i,u.open(g,d,!p,t.username,t.password),p||(u.withCredentials=!!t.withCredentials),!p&&t.timeout>0&&(c=setTimeout(function(){if(!f){f=!0,u.abort("timeout");var t=new Error("XMLHttpRequest timeout");t.code="ETIMEDOUT",i(t)}},t.timeout)),u.setRequestHeader)for(h in m)m.hasOwnProperty(h)&&u.setRequestHeader(h,m[h]);else if(t.headers&&!r(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(u.responseType=t.responseType),"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(u),u.send(v||null),u}function s(t){if("document"===t.responseType)return t.responseXML;var e=t.responseXML&&"parsererror"===t.responseXML.documentElement.nodeName;return""!==t.responseType||e?null:t.responseXML}function l(t){return'\n<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>\n<td align="center">\n<div style="display: table-cell; vertical-align: middle;">\n<div style="">'+t+"</div>\n</div>\n</td></tr></table>\n"}function u(t,e,i){function r(e){var i=t.parentNode;i&&(i.innerHTML=l(e))}function n(t,e){"function"==typeof i?i(t):r(e)}if(!window.WebGLRenderingContext)return n(O,N),null;var o=h(t,e);return o?o.getExtension("OES_standard_derivatives"):n(G,j),o}function h(t,e){for(var i=["webgl","experimental-webgl"],r=null,n=0;n<i.length;++n)try{r=t.getContext(i[n],e)}catch(t){if(r)break}return r}function f(t,e,i){var r=t.gl,n=r.createShader(i);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(H=r.getShaderInfoLog(n),console.error("*** Error compiling shader "+n+":"+H),t.trigger("error",{shader:n,source:e,type:i,error:H}),r.deleteShader(n),null)}function c(t,e,i,r){for(var n=t.gl,o=n.createProgram(),a=0;a<e.length;++a)n.attachShader(o,e[a]);if(i)for(var s=0;s<i.length;++s)n.bindAttribLocation(o,r?r[s]:s,i[s]);return n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)?o:(H=n.getProgramInfoLog(o),console.log("Error in program linking:"+H),n.deleteProgram(o),null)}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[];for(var r in t){var n=t[r],o=void 0;if(e&&(r=e+"."+r),"number"==typeof n)i.push({type:"float",method:"1f",name:r,value:n});else if(Array.isArray(n)){if("number"==typeof n[0])1===n.length?i.push({type:"float",method:"1f",name:r,value:n}):n.length>=2&&n.length<=4?i.push({type:"vec"+n.length,method:n.length+"fv",name:r,value:n}):n.length>4&&i.push({type:"float[]",method:"1fv",name:r+"[0]",value:n});else if("string"==typeof n[0])i.push({type:"sampler2D",method:"1i",name:r,value:n});else if(Array.isArray(n[0])&&"number"==typeof n[0][0]){if(n[0].length>=2&&n[0].length<=4)for(o=0;o<n.length;o++)i.push({type:"vec"+n[0].length,method:n[o].length+"fv",name:r+"["+o+"]",value:n[o]})}else if("object"===I(n[0]))for(o=0;o<n.length;o++)i.push.apply(i,F(d(n[o],r+"["+o+"]")))}else"boolean"==typeof n?i.push({type:"bool",method:"1i",name:r,value:n}):"string"==typeof n?i.push({type:"sampler2D",method:"1i",name:r,value:n}):"object"===(void 0===n?"undefined":I(n))&&i.push.apply(i,F(d(n,r)))}return i}function g(t){return t.getBoundingClientRect().top+t.height>0&&t.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)}function v(t){return 0==(t&t-1)}function m(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function p(t,e){return!(!t||!e)&&t.toString()!==e.toString()}function y(t){var e=new Set;return Object.assign(t,{on:function(t,i){var r={};r[t]=i,e.add(r)},off:function(t,i){if(i){var r={};r[t]=i,e.delete(r)}else{var n=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value,h=!0,f=!1,c=void 0;try{for(var d,g=Object.keys(u)[Symbol.iterator]();!(h=(d=g.next()).done);h=!0)if(d.value===t)return void e.delete(u)}catch(t){f=!0,c=t}finally{try{!h&&g.return&&g.return()}finally{if(f)throw c}}}}catch(t){o=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}}},listSubscriptions:function(){var t=!0,i=!1,r=void 0;try{for(var n,o=e[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;console.log(a)}}catch(t){i=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}},subscribe:function(t){e.add(t)},unsubscribe:function(t){e.delete(t)},unsubscribeAll:function(){e.clear()},trigger:function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var o=!0,a=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;"function"==typeof h[t]&&h[t].apply(h,F(r))}}catch(t){a=!0,s=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}}})}function E(){var t=document.getElementsByClassName("glslCanvas");if(t.length>0){window.glslCanvases=[];for(var e=0;e<t.length;e++){var i=new q(t[e]);i.isValid&&window.glslCanvases.push(i)}}}var T,b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},R=T="undefined"!=typeof window?window:void 0!==b?b:"undefined"!=typeof self?self:{},_=function(t){var e=x.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)},x=Object.prototype.toString,w=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){(e=t.exports=function(t){return t.replace(/^\s*|\s*$/g,"")}).left=function(t){return t.replace(/^\s*/,"")},e.right=function(t){return t.replace(/\s*$/,"")}}),A=function(r,n,o){if(!_(n))throw new TypeError("iterator must be a function");arguments.length<3&&(o=this),"[object Array]"===S.call(r)?t(r,n,o):"string"==typeof r?e(r,n,o):i(r,n,o)},S=Object.prototype.toString,L=Object.prototype.hasOwnProperty,P=function(t){return"[object Array]"===Object.prototype.toString.call(t)},U=function(t){if(!t)return{};var e={};return A(w(t).split("\n"),function(t){var i=t.indexOf(":"),r=w(t.slice(0,i)).toLowerCase(),n=w(t.slice(i+1));void 0===e[r]?e[r]=n:P(e[r])?e[r].push(n):e[r]=[e[r],n]}),e},X=function(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var r in i)D.call(i,r)&&(t[r]=i[r])}return t},D=Object.prototype.hasOwnProperty,M=o;o.XMLHttpRequest=R.XMLHttpRequest||function(){},o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:R.XDomainRequest,function(t,e){for(var i=0;i<t.length;i++)e(t[i])}(["get","put","post","patch","head","delete"],function(t){o["delete"===t?"del":t]=function(e,i,r){return i=n(e,i,r),i.method=t.toUpperCase(),a(i)}});var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k=(function(){function t(t){this.value=t}function e(e){function i(n,o){try{var a=e[n](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){i("next",t)},function(t){i("throw",t)}):r(a.done?"return":"normal",a.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":n.resolve({value:e,done:!0});break;case"throw":n.reject(e);break;default:n.resolve({value:e,done:!1})}(n=n.next)?i(n.key,n.arg):o=null}var n,o;this._invoke=function(t,e){return new Promise(function(r,a){var s={key:t,arg:e,resolve:r,reject:a,next:null};o?o=o.next=s:(n=o=s,i(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),C=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),F=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},H="",N='\n\tThis page requires a browser that supports WebGL.<br/>\n\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>\n',j='\n\tIt does not appear your computer can support WebGL.<br/>\n\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>\n',O=1,G=2,B=function(){function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};k(this,t),y(this),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(r.filtering),this.load(r)}return C(t,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(e){this.valid&&("number"==typeof e&&t.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),t.activeUnit=e),t.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),t.activeTexture=this.texture))}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=null,"string"==typeof t.url?void 0!==this.url&&t.url===this.url||this.setUrl(t.url,t):t.element?this.setElement(t.element,t):t.data&&t.width&&t.height&&this.setData(t.width,t.height,t.data,t)}},{key:"setUrl",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=t,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,n){var o=t.split(".").pop().toLowerCase(),a="ogv"===o||"webm"===o||"mp4"===o,s=void 0;a?((s=document.createElement("video")).autoplay=!0,i.filtering="nearest"):s=new Image,s.onload=function(){try{e.setElement(s,i)}catch(t){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",t,i)}r(e)},s.onerror=function(t){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",t,i),r(e)},m()&&"data:"===e.source.slice(0,5)||(s.crossOrigin="anonymous"),s.src=e.source,a&&e.setElement(s,i)}),this.loading}},{key:"setData",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=t,this.height=e,this.source=i,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var i=this,r=t;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.source=t,this.sourceType="element",t instanceof HTMLVideoElement?(t.addEventListener("canplaythrough",function(){i.intervalID=setInterval(function(){i.update(e)},15)},!0),t.addEventListener("ended",function(){t.currentTime=0,t.play()},!0)):this.update(e),this.setFiltering(e);else{var n="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+n,e)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==t.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),"element"===this.sourceType&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):"data"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){this.powerOf2=v(this.width)&&v(this.height);var e=this.powerOf2?"mipmap":"linear";this.filtering=t.filtering||e;var i=this.gl;this.bind(),this.powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===this.filtering&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"mipmap"===this.filtering&&(this.filtering="linear"),"nearest"===this.filtering?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)))}}}]),t}();B.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},B.activeUnit=-1;var q=function(){function t(e,i,r){function n(){v.nMouse>1&&v.setMouse(g),v.render(),v.forceRender=v.resize(),window.requestAnimationFrame(n)}var o=this;k(this,t),y(this),i=i||{},r=r||{},this.width=e.clientWidth,this.height=e.clientHeight,this.canvas=e,this.gl=void 0,this.program=void 0,this.textures={},this.uniforms={},this.vbo={},this.isValid=!1,this.vertexString=i.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",this.fragmentString=i.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n    gl_FragColor = vec4(0.0);\n}\n";var a=u(e,i,r.onError);if(a){if(this.gl=a,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,e.style.backgroundColor=i.backgroundColor||"rgba(1,1,1,0)",e.hasAttribute("data-fragment"))this.fragmentString=e.getAttribute("data-fragment");else if(e.hasAttribute("data-fragment-url")){var s=e.getAttribute("data-fragment-url");M.get(s,function(t,e,i){o.load(i,o.vertexString)})}if(e.hasAttribute("data-vertex"))this.vertexString=e.getAttribute("data-vertex");else if(e.hasAttribute("data-vertex-url")){var l=e.getAttribute("data-vertex-url");M.get(l,function(t,e,i){o.load(o.fragmentString,i)})}if(this.load(),this.program){var h=a.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=a.createBuffer(),this.gl.bindBuffer(a.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,2,a.FLOAT,!1,0,0);var f=a.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=a.createBuffer(),this.gl.bindBuffer(a.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW),this.gl.enableVertexAttribArray(f),this.gl.vertexAttribPointer(f,2,a.FLOAT,!1,0,0),e.hasAttribute("data-textures")){var c=e.getAttribute("data-textures").split(",");for(var d in c)this.setUniform("u_tex"+d,c[d])}var g={x:0,y:0};document.addEventListener("mousemove",function(t){g.x=t.clientX||t.pageX,g.y=t.clientY||t.pageY},!1);var v=this;return this.setMouse({x:0,y:0}),n(),this}}}return C(t,[{key:"destroy",value:function(){this.animated=!1,this.isValid=!1;for(var t in this.textures)t.destroy&&t.destroy();this.textures={};for(var e in this.attribs)this.gl.deleteBuffer(this.attribs[e]);this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.gl=null}},{key:"load",value:function(t,e){if(e&&(this.vertexString=e),t&&(this.fragmentString=t),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1,this.fragmentString.search(/sampler2D/g))for(var i=this.fragmentString.split("\n"),r=0;r<i.length;r++){var n=i[r].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(n){var o=n[2].split(".").pop().toLowerCase();n[1]&&n[2]&&("jpg"===o||"jpeg"===o||"png"===o||"ogv"===o||"webm"===o||"mp4"===o)&&this.setUniform(n[1],n[2])}if(i[r].match(/\s*void\s*main\s*/g))break}var a=f(this,this.vertexString,this.gl.VERTEX_SHADER),s=f(this,this.fragmentString,this.gl.FRAGMENT_SHADER);s?this.isValid=!0:(s=f(this,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",this.gl.FRAGMENT_SHADER),this.isValid=!1);var l=c(this,[a,s]);this.gl.useProgram(l),this.gl.deleteShader(a),this.gl.deleteShader(s),this.program=l,this.change=!0,this.trigger("load",{}),this.forceRender=!0}},{key:"test",value:function(t,e,i){function r(){f.paused=s,(e||i)&&f.load(a,o)}function n(){f.forceRender=!0,f.render();var o=l.getQueryObjectEXT(u,l.QUERY_RESULT_AVAILABLE_EXT),a=f.gl.getParameter(l.GPU_DISJOINT_EXT);if(o&&!a){var s={wasValid:h,frag:e||f.fragmentString,vert:i||f.vertexString,timeElapsedMs:l.getQueryObjectEXT(u,l.QUERY_RESULT_EXT)/1e6};r(),t(s)}else window.requestAnimationFrame(n)}var o=this.vertexString,a=this.fragmentString,s=this.paused,l=this.gl.getExtension("EXT_disjoint_timer_query"),u=l.createQueryEXT(),h=this.isValid;(e||i)&&(this.load(e,i),h=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,l.beginQueryEXT(l.TIME_ELAPSED_EXT,u),this.forceRender=!0,this.render(),l.endQueryEXT(l.TIME_ELAPSED_EXT);var f=this;n()}},{key:"loadTexture",value:function(t,e,i){var r=this;i||(i={}),"string"==typeof e?i.url=e:"object"===(void 0===e?"undefined":I(e))&&e.data&&e.width&&e.height?(i.data=e.data,i.width=e.width,i.height=e.height):"object"===(void 0===e?"undefined":I(e))&&(i.element=e),this.textures[t]?this.textures[t]&&(this.textures[t].load(i),this.textures[t].on("loaded",function(t){r.forceRender=!0})):(this.textures[t]=new B(this.gl,t,i),this.textures[t].on("loaded",function(t){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(t){for(var e={},i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e[t]=r,this.setUniforms(e)}},{key:"setUniforms",value:function(t){var e=d(t);for(var i in e)"sampler2D"===e[i].type?this.loadTexture(e[i].name,e[i].value[0]):(this.uniform(e[i].method,e[i].type,e[i].name,e[i].value),this.forceRender=!0)}},{key:"setMouse",value:function(t){var e=this.canvas.getBoundingClientRect();t&&t.x&&t.x>=e.left&&t.x<=e.right&&t.y&&t.y>=e.top&&t.y<=e.bottom&&this.uniform("2f","vec2","u_mouse",t.x-e.left,this.canvas.height-(t.y-e.top))}},{key:"uniform",value:function(t,e,i){this.uniforms[i]=this.uniforms[i]||{};for(var r=this.uniforms[i],n=arguments.length,o=Array(n>3?n-3:0),a=3;a<n;a++)o[a-3]=arguments[a];(p(r.value,o)||this.change||void 0===r.location||void 0===r.value)&&(r.name=i,r.value=o,r.type=e,r.method="uniform"+t,r.location=this.gl.getUniformLocation(this.program,i),this.gl[r.method].apply(this.gl,[r.location].concat(r.value)))}},{key:"uniformTexture",value:function(t,e,i){void 0===this.textures[t]?this.loadTexture(t,e,i):(this.uniform("1i","sampler2D",t,this.texureIndex),this.textures[t].bind(this.texureIndex),this.uniform("2f","vec2",t+"Resolution",this.textures[t].width,this.textures[t].height),this.texureIndex++)}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){var t=window.devicePixelRatio||1,e=Math.floor(this.gl.canvas.clientWidth*t),i=Math.floor(this.gl.canvas.clientHeight*t);return this.gl.canvas.width===e&&this.gl.canvas.height===i||(this.gl.canvas.width=e,this.gl.canvas.height=i,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,!0}return!1}},{key:"render",value:function(){if(this.visible=g(this.canvas),this.forceRender||this.animated&&this.visible&&!this.paused){var t=new Date,e=performance.now();this.timeDelta=(e-this.timePrev)/1e3,this.timePrev=e,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(e-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),3600*t.getHours()+60*t.getMinutes()+t.getSeconds()+.001*t.getMilliseconds()),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height),this.texureIndex=0;for(var i in this.textures)this.uniformTexture(i);this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"version",value:function(){return"0.0.25"}}]),t}();return window.addEventListener("load",function(){E()}),q});
//# sourceMappingURL=GlslCanvas.min.js.map
